# ‚úÖ VIDA SMART COACH ‚Äî DOCUMENTO MESTRE (Single Source of Truth)
Data: 21/10/2025 ‚Ä¢ Respons√°vel: JE (agenciaclimb) ‚Ä¢ Autor da atualiza√ß√£o: GitHub Copilot ‚Ä¢ Status geral: Em Progresso

Este documento reflete o estado real e verificado do sistema em produ√ß√£o e reposit√≥rio. Todas as afirma√ß√µes abaixo foram validadas em c√≥digo-fonte e configura√ß√£o presentes na branch main nesta data.

## üéØ Status atual por m√≥dulo

### Infraestrutura e Deploy
- Vercel (Frontend): Produ√ß√£o publicada com sucesso em 21/10/2025 (√∫ltimo deploy manual bem-sucedido). Evid√™ncia: comando de deploy retornou Exit Code 0.
- Supabase (Banco + Edge Functions): Operacional. Project ID: `zzugbgoylwbaojdnunuz` (em `supabase/config.toml`).
- Edge Functions ativas no c√≥digo: `ia-coach-chat`, `evolution-webhook`, `generate-plan`, `trial-reminder`, entre outras utilit√°rias (lista em Arquitetura > Fun√ß√µes). Verifica√ß√£o: arquivos presentes em `supabase/functions/*/index.ts`.
- Seguran√ßa de fun√ß√µes: `verify_jwt = false` para `ia-coach-chat`, `evolution-webhook` e `trial-reminder` (conforme `supabase/config.toml`), com valida√ß√£o cruzada via `X-Internal-Secret` entre fun√ß√µes.

### WhatsApp (Evolution Webhook)
- Implementado em `supabase/functions/evolution-webhook/index.ts`.
   - Recebe `messages.upsert`, ignora mensagens do pr√≥prio bot, normaliza telefone, salva no hist√≥rico, de-duplica mensagens em 30s.
   - Emerg√™ncia: detecta palavras-chave cr√≠ticas e envia resposta via Evolution API; registra alerta em `emergency_alerts`.
   - Integra√ß√£o com IA: chama `ia-coach-chat` com Authorization (ANON/SERVICE) e cabe√ßalho `X-Internal-Secret`.
   - Envia resposta ao usu√°rio e persiste a resposta em `whatsapp_messages` (ap√≥s envio bem-sucedido).
- Banco alinhado: migra√ß√µes 2025-10-21 normalizam `phone`, criam √≠ndices e constraints num√©ricas (ver Migra√ß√µes).
- Status: Conclu√≠do/Operacional.

### IA Coach de Conversa (4 est√°gios)
- Implementado em `supabase/functions/ia-coach-chat/index.ts`.
   - Est√°gios: SDR (SPIN Selling) ‚Üí Specialist ‚Üí Seller (envia link de cadastro) ‚Üí Partner.
   - Valida√ß√£o interna: `X-Internal-Secret` obrigat√≥ria quando definida.
   - Persist√™ncia: salva intera√ß√£o em `interactions` e est√°gio em `client_stages`.
   - Contexto: carrega dados de usu√°rio (atividades, miss√µes, metas, planos, gamifica√ß√£o, mem√≥rias) para personalizar.
- Observa√ß√µes t√©cnicas importantes:
   - SDR possui SPIN Selling com progress√£o linear e anti-repeti√ß√£o.
   - Seller envia link de cadastro direto: https://appvidasmart.com/cadastro.
   - BUG identificado na fun√ß√£o Specialist (detalhes em Erros Conhecidos): condi√ß√£o de avan√ßo ileg√≠tima e vari√°vel n√£o definida.
- Status: Em Progresso (funcional com ressalvas; corre√ß√£o no Specialist pendente).

### Gera√ß√£o de Planos por IA
- Edge Function `generate-plan` em `supabase/functions/generate-plan/index.ts`:
   - Recebe `{ userId, planType, userProfile }`.
   - Chama OpenAI `gpt-4o-mini` com `response_format: json_object` e salva em `user_training_plans` (`is_active=true`).
   - Tipos: `physical`, `nutritional`, `emotional`, `spiritual`. Cada prompt retorna JSON v√°lido; rejeita n√£o-JSON.
- Frontend integrado:
   - Contexto: `src/contexts/data/PlansContext.jsx` exp√µe `generatePersonalizedPlan()` (gera 4 planos) e `generateMissingPlans()`.
   - UI: `src/components/client/PlanTab.jsx` exibe os 4 planos em abas e mostra bot√µes ‚ÄúGerar planos faltantes (n)‚Äù e ‚ÄúRegerar todos os planos‚Äù quando aplic√°vel.
- Status: Em Progresso (pipeline de gera√ß√£o e exibi√ß√£o implementado; requer valida√ß√£o em produ√ß√£o por usu√°rio real e robustez de erros).

### Gamifica√ß√£o e Check-ins
- PlanTab integra `useGamification` e exibe pontua√ß√£o, n√≠vel e conquistas; componente `CheckinSystem` aparece no fluxo de planos.
- Status: Em Progresso (exibi√ß√£o integrada no painel; backend n√£o auditado nesta atualiza√ß√£o).

### Stripe
- O reposit√≥rio possui hist√≥rico de ‚Äúwebhook Stripe simplificado e funcional‚Äù (14/10). Nesta atualiza√ß√£o, n√£o houve revalida√ß√£o completa de eventos de cobran√ßa.
- Status: N√£o revalidado (presen√ßa confirmada por hist√≥rico anterior; funcionalidade n√£o auditada hoje).

### Google Calendar
- Fun√ß√µes presentes no c√≥digo: `get-google-calendar-credentials`, `get-active-provider` (arquivos em `supabase/functions/*`).
- Status: N√£o revalidado (presen√ßa confirmada; integra√ß√£o n√£o testada nesta atualiza√ß√£o).

## üèóÔ∏è Arquitetura e principais artefatos

### Edge Functions (arquivos verificados)
- `supabase/functions/evolution-webhook/index.ts` ‚Äî Integra√ß√£o WhatsApp Evolution; normaliza√ß√£o e de-duplica√ß√£o; chamada IA.
- `supabase/functions/ia-coach-chat/index.ts` ‚Äî Motor conversacional 4 est√°gios; SPIN no SDR; valida√ß√£o por segredo interno; grava√ß√£o em DB.
- `supabase/functions/generate-plan/index.ts` ‚Äî Gera e persiste planos JSON por tipo via OpenAI.
- Outras fun√ß√µes presentes (n√£o revalidadas): `trial-reminder`, `send-whatsapp-notification`, `checkin-automation`, `evolution-qr`, `admin-*`, `agent-*`, `account-*`, `get-google-credentials`.

### Frontend
- `src/contexts/data/PlansContext.jsx` ‚Äî Carrega planos ativos; gera 4 planos; gera faltantes; logs de debug e valida√ß√µes de `plan_data`.
- `src/components/client/PlanTab.jsx` ‚Äî UI de planos com abas, gamifica√ß√£o, check-ins; bot√µes de gera√ß√£o (faltantes e total).

### Configura√ß√£o de Fun√ß√µes
- `supabase/config.toml`: `verify_jwt = false` para `ia-coach-chat`, `evolution-webhook`, `trial-reminder` (valida√ß√£o via `X-Internal-Secret`).

### Migra√ß√µes relevantes (WhatsApp)
- `20251021_normalize_existing_phones.sql` ‚Äî Remove sufixos `@s.whatsapp.net` e normaliza dados legados.
- `20251021_add_phone_constraints_and_index.sql` ‚Äî Sanitiza para d√≠gitos, √≠ndice por `phone`, constraints: sem sufixo e num√©rico-only.
- `20251021_fix_whatsapp_messages_structure.sql` ‚Äî Estrutura consistente e √≠ndices para `whatsapp_messages`.

## üß≠ Pend√™ncias e impacto (somente fatos verificados)

1) Corrigir avan√ßo e anti-loop no est√°gio Specialist
- Impacto: M√©dio/Alto ‚Äî risco de erro em runtime (quebra de fluxo) e repeti√ß√£o de √°rea.
- Evid√™ncia: em `ia-coach-chat/index.ts` existe refer√™ncia a `questionCount` n√£o definida e express√£o solta na linha de decis√£o do Specialist.
- Depend√™ncia: Nenhuma externa; ajuste local de l√≥gica.
- Prioridade: Alta.

2) Persistir progresso de √°reas no Specialist
- Impacto: M√©dio ‚Äî IA pode revisitar a mesma √°rea e gerar sensa√ß√£o de repeti√ß√£o.
- Evid√™ncia: N√£o h√° leitura/escrita de ‚Äú√°reas j√° diagnosticadas‚Äù em `client_stages.stage_metadata` ou tabela pr√≥pria.
- Depend√™ncia: Modelo de dados e pequena migra√ß√£o/uso de `stage_metadata`.
- Prioridade: Alta.

3) Valida√ß√£o end-to-end do sistema de planos no ambiente de produ√ß√£o (UI ‚Üí Edge Function ‚Üí DB ‚Üí UI)
- Impacto: Alto ‚Äî Gera√ß√£o vis√≠vel no painel do cliente.
- Evid√™ncia: UI e fun√ß√£o presentes; falta checklist de valida√ß√£o em produ√ß√£o com usu√°rio real.
- Depend√™ncia: Credenciais OpenAI e Supabase no ambiente de produ√ß√£o.
- Prioridade: Alta.

4) Robustez de chamadas OpenAI (timeouts e mensagens do usu√°rio)
- Impacto: M√©dio ‚Äî Melhor UX e redu√ß√£o de falhas intermitentes.
- Evid√™ncia: `evolution-webhook` j√° usa AbortController 25s; `generate-plan` e `ia-coach-chat` n√£o t√™m timeout expl√≠cito.
- Prioridade: M√©dia.

5) Auditoria de Stripe e Google Calendar
- Impacto: M√©dio ‚Äî Cobran√ßa/agenda.
- Evid√™ncia: Fun√ß√µes presentes; sem revalida√ß√£o nesta data.
- Prioridade: M√©dia.

6) RLS e pol√≠ticas de leitura/registro para novas tabelas
- Impacto: M√©dio ‚Äî Seguran√ßa e UX.
- Evid√™ncia: `whatsapp_messages` com pol√≠ticas; revisar `interactions`, `client_stages`, `user_training_plans`.
- Prioridade: M√©dia.

### üé® Melhorias de UX/UI e Gamifica√ß√£o (Identificadas em 22/10/2025)

**Diagn√≥stico Atual:**
- Visual est√°tico e pouco inspirador ‚Äî falta dinamismo e feedback visual imediato
- Gamifica√ß√£o superficial ‚Äî pontos e n√≠veis sem recompensas tang√≠veis ou narrativa envolvente
- Aus√™ncia de progress√£o visual clara ‚Äî dif√≠cil ver evolu√ß√£o ao longo do tempo
- Falta de personaliza√ß√£o ‚Äî experi√™ncia gen√©rica para todos os usu√°rios
- Baixo engajamento emocional ‚Äî interface funcional mas n√£o inspiradora

**Integra√ß√£o Atual Verificada (22/10/2025):**
- ‚úÖ IA carrega `activePlans` de `user_training_plans` e `gamification` de `user_gamification_summary` (contexto para personaliza√ß√£o)
- ‚úÖ PlanTab exibe dados de gamifica√ß√£o (`useGamification` hook) com pontos, n√≠vel e conquistas
- ‚úÖ Pontos gerados: gera√ß√£o de planos (+30 XP), progress√£o IA (+50 XP)
- ‚ùå **Gaps identificados:**
  - Sem tracking de conclus√£o de exerc√≠cios/refei√ß√µes/pr√°ticas (checkboxes)
  - Sem indicador visual de progresso (% do plano completado)
  - Feedback do usu√°rio n√£o notifica IA nem regenera planos
  - IA n√£o sugere proativamente itens espec√≠ficos dos planos

**Roadmap de Melhorias (3 N√≠veis):**

#### üî¥ N√çVEL 1: Quick Wins (Prioridade ALTA ‚Äî 1-2 semanas)
Impacto alto, esfor√ßo baixo ‚Äî melhorias que podem ser implementadas rapidamente

- Anima√ß√µes e micro-intera√ß√µes (framer-motion)
  - Feedback visual ao completar tarefas (confete, checkmark animado)
  - Transi√ß√µes suaves entre estados
  - Barra de progresso com efeito de preenchimento
  - Badges que "pulam" ao serem conquistados
  - Contador de pontos com crescimento animado

- Dashboard de progresso visual aprimorado
  - Streak Counter (sequ√™ncia de dias) com chama animada üî•
  - Calend√°rio visual com check-marks nos dias completos
  - Gr√°fico de evolu√ß√£o semanal (mini-chart)
  - Badges de conquistas recentes em destaque

- Sistema de feedback imediato
  - Toast notifications celebrativas personalizadas
  - Som sutil de conquista (opcional, desativ√°vel)
  - Mensagens motivacionais contextuais por hor√°rio

#### üü° N√çVEL 2: Game Changers (Prioridade M√âDIA ‚Äî 2-4 semanas)
Funcionalidades que diferenciam o produto no mercado

- Sistema de recompensas tang√≠veis (Loja de Benef√≠cios)
  - Digitais: sess√µes extras IA Coach, relat√≥rios PDF, badges exclusivos, temas premium
  - Conte√∫do: e-books, v√≠deo-aulas, planos avan√ßados, receitas
  - Servi√ßos: consultoria 1:1, ajuste de plano, comunidade VIP

- Narrativa de jornada do her√≥i (Tiers de Progress√£o)
  - N√≠vel 1-10: üå± Aprendiz do Bem-Estar
  - N√≠vel 11-20: üåø Guardi√£o da Sa√∫de
  - N√≠vel 21-30: üå≥ Mestre do Equil√≠brio
  - N√≠vel 31-40: üèÜ Lenda Viva
  - N√≠vel 41+: ‚≠ê Inspira√ß√£o para Outros
  - Benef√≠cios desbloqueados por tier

- Desafios e eventos tempor√°rios
  - Semanais: temas espec√≠ficos (hidrata√ß√£o, medita√ß√£o)
  - Mensais: metas ambiciosas com recompensas maiores
  - Sazonais: eventos especiais (Ano Novo, Ver√£o)
  - Comunit√°rios: metas coletivas

- Sistema de compara√ß√£o social saud√°vel
  - C√≠rculos privados (at√© 5 amigos)
  - Ranking privado do grupo
  - Modo cooperativo (metas compartilhadas)
  - Mensagens de motiva√ß√£o autom√°ticas

#### üü¢ N√çVEL 3: Inova√ß√µes Disruptivas (Prioridade BAIXA ‚Äî 4-8 semanas)
Funcionalidades que posicionam o produto como l√≠der de mercado

- IA preditiva e recomenda√ß√µes inteligentes
  - An√°lise de padr√µes comportamentais (melhores hor√°rios, dias produtivos)
  - Previs√µes e alertas proativos (burnout, necessidade de descanso)
  - Recomenda√ß√µes adaptativas (dificuldade, novas √°reas)

- Visualiza√ß√µes avan√ßadas de dados
  - Radar Chart dos 4 Pilares (equil√≠brio visual)
  - Heatmap de consist√™ncia 365 dias (estilo GitHub)
  - Gr√°ficos de tend√™ncia (peso, humor, energia, sono, estresse)
  - Relat√≥rio mensal autom√°tico PDF (compartilh√°vel)

- Integra√ß√£o com dispositivos externos
  - Wearables: Apple Health, Google Fit, Fitbit, Garmin, Xiaomi Mi Band
  - Apps fitness: Strava, Nike Training, Headspace, Calm
  - Apps nutri√ß√£o: MyFitnessPal, Fatsecret, Yazio

- Hub comunit√°rio
  - Feed social de conquistas (opcional)
  - Grupos tem√°ticos moderados
  - Sistema de mentoria (veteranos ‚Üí iniciantes)
  - Accountability partners (duplas de motiva√ß√£o)

#### üö® Melhorias Cr√≠ticas Imediatas (Sprint 1-2)
**Prioridade P0 ‚Äî Implementar ANTES de outras features**

1. **Checkboxes de conclus√£o + gamifica√ß√£o** (ALTA)
   - Exerc√≠cios f√≠sicos ‚Üí +10 XP por workout completo
   - Refei√ß√µes ‚Üí +5 XP por meal seguida
   - Pr√°ticas emocionais/espirituais ‚Üí +8 XP
   - Nova tabela: `plan_completions` (user_id, plan_type, item_id, completed_at)
   - Componente: Checkbox em cada exerc√≠cio/refei√ß√£o/pr√°tica
   - Hook: `addDailyActivity` ao marcar como conclu√≠do

2. **Indicadores visuais de progresso** (ALTA)
   - C√°lculo: % completado = itens_completados / total_itens
   - Progress bar no header de cada plano
   - Display: "Semana X de Y (Z% completo)"
   - Agrega√ß√£o: progresso geral dos 4 pilares

3. **Loop de feedback ‚Üí IA** (M√âDIA)
   - Nova tabela: `plan_feedback` (user_id, plan_type, feedback_text, created_at, status)
   - `handleFeedbackSubmit`: salvar no DB (atualmente s√≥ toast)
   - `fetchUserContext` (IA): incluir `pendingFeedback` no contexto
   - Prompt IA: detectar feedback e oferecer regenera√ß√£o/ajuste

4. **IA proativa com planos espec√≠ficos** (M√âDIA)
   - `buildContextPrompt`: incluir itens do dia atual (exerc√≠cios, refei√ß√µes, pr√°ticas)
   - Partner stage: referenciar especificamente ("Vi que hoje no seu plano est√° Treino A - Peito/Tr√≠ceps")
   - Sugest√µes baseadas em progresso real do plano

## üêû Erros conhecidos (causa, status, corre√ß√£o sugerida)

1) ~~Specialist: vari√°vel indefinida e condi√ß√£o inv√°lida~~ ‚úÖ **CORRIGIDO em 22/10/2025**
- Local: `supabase/functions/ia-coach-chat/index.ts`, fun√ß√£o `processSpecialistStage`
- Causa: refatora√ß√£o incompleta ‚Äî uso de `questionCount` sem defini√ß√£o e express√£o quebrada na linha:
  - `const shouldAdvance = questionCount >= 3; message.toLowerCase().includes('quero');`
- Status: **Conclu√≠do** (deploy em 22/10/2025 √†s 09:58 UTC).
- Corre√ß√£o aplicada:
  - Implementado contador local: `const questionsAsked = chatHistory?.filter(m => m.role === 'assistant').length;`
  - Detec√ß√£o de interesse: `const wantsToAdvance = /\b(quero|aceito|sim|vamos|pode ser|topo)\b/i.test(message);`
  - Condi√ß√£o unificada: `const shouldAdvance = questionsAsked >= 3 || wantsToAdvance;`
  - Metadados enriquecidos: salvam `questionsAsked` e `wantsToAdvance` para an√°lise.
- Valida√ß√£o: Teste executado com sucesso (HTTP 200, c√≥digo n√£o quebra, l√≥gica funcional).

2) SDR ‚Üí Specialist: persist√™ncia de √°reas
- Local: Specialist (constru√ß√£o de prompt menciona anti-loop; n√£o h√° persist√™ncia)
- Causa prov√°vel: falta de camada de estado por √°rea.
- Status: Pendente.
- Corre√ß√£o sugerida: usar `client_stages.stage_metadata` para registrar √°reas j√° cobertas e consultar antes de perguntar.

3) Timeouts padronizados nas fun√ß√µes que chamam OpenAI
- Local: `generate-plan` e `ia-coach-chat`.
- Causa prov√°vel: aus√™ncia de AbortController local.
- Status: Pendente.
- Corre√ß√£o sugerida: aplicar AbortController/try-catch com resposta amig√°vel.

## ‚ñ∂Ô∏è Pr√≥ximas a√ß√µes (ordem t√©cnica e rastreabilidade)

Legenda de Status: Conclu√≠do | Em Progresso | Pendente

1) ~~Corrigir Specialist e anti-loop~~ ‚úÖ **CONCLU√çDO em 22/10/2025**
- Dono: JE ‚Ä¢ Conclu√≠do: 22/10/2025 √†s 09:58 UTC
- A√ß√µes realizadas:
  - ‚úÖ Ajustado `shouldAdvance` na fun√ß√£o Specialist (removida vari√°vel indefinida; unificada condi√ß√£o).
  - ‚úÖ Implementada contagem de perguntas do assistente via `chatHistory`.
  - ‚úÖ Adicionada detec√ß√£o de interesse expl√≠cito com regex.
  - ‚úÖ Metadados enriquecidos (`questionsAsked`, `wantsToAdvance`).
  - ‚úÖ Deploy realizado (script 78.56 kB).
  - ‚úÖ Teste de valida√ß√£o executado com sucesso.
- Pr√≥ximo: Implementar persist√™ncia de √°reas cobertas em `client_stages.stage_metadata` (previsto para 23/10).

2) Validar gera√ß√£o de planos E2E em produ√ß√£o (Em Progresso)
- Dono: JE ‚Ä¢ Prazo alvo: 22/10/2025
- Passos:
   - Abrir painel ‚Üí aba Plano ‚Üí for√ßar ‚ÄúGerar planos faltantes‚Äù e depois recarregar.
   - Confirmar inserts em `user_training_plans` com `is_active=true`.
   - Validar renderiza√ß√£o nas 4 abas (dados n√£o vazios/estruturados).

3) Padronizar timeouts/respostas de OpenAI (Pendente)
- Dono: JE ‚Ä¢ Prazo: 23/10/2025
- Passos:
   - Adicionar AbortController (25-30s) em `generate-plan` e `ia-coach-chat`.
   - Mensagem de fallback amig√°vel e log de erro com `details`.

4) Auditoria de Stripe e Google Calendar (Pendente)
- Dono: JE ‚Ä¢ Prazo: 25/10/2025
- Passos:
   - Stripe: listar eventos e testar webhook de teste; documentar status real.
   - Calendar: testar credenciais e escopos; documentar.

5) Revis√£o de RLS e pol√≠ticas (Pendente)
- Dono: JE ‚Ä¢ Prazo: 24/10/2025
- Passos:
   - Verificar pol√≠ticas em `interactions`, `client_stages`, `user_training_plans`.
   - Garantir que o cliente v√™ apenas seus dados e que fun√ß√µes SERVICE t√™m acesso necess√°rio.

### üé® Roadmap de Melhorias UX/UI e Gamifica√ß√£o (Iniciado em 22/10/2025)

**üìÑ Documento completo:** Ver `PLANO_ACAO_UX_GAMIFICACAO.md` para detalhamento t√©cnico completo.

**Objetivo estrat√©gico:** Transformar experi√™ncia funcional em experi√™ncia envolvente e inspiradora atrav√©s de gamifica√ß√£o profunda, feedback visual imediato, e sistema de recompensas tang√≠veis.

**Sprints planejados:**
- üèÉ **Sprint 1-2 (23/10-06/11):** Quick Wins ‚Äî Checkboxes de conclus√£o, progress tracking, anima√ß√µes, streak counter
- üèÉ **Sprint 3-4 (07/11-20/11):** Game Changers ‚Äî Loja de recompensas, narrativa de jornada, badges
- üèÉ **Sprint 5-6 (21/11-04/12):** Social ‚Äî Desafios tempor√°rios, c√≠rculos de motiva√ß√£o
- üèÉ **Sprint 7-10 (05/12-01/01):** Inova√ß√µes ‚Äî IA preditiva, analytics avan√ßados, integra√ß√µes externas

**Prioridade P0 (Cr√≠tica ‚Äî Bloqueador):**
1. Checkboxes de conclus√£o + gamifica√ß√£o (exerc√≠cios, refei√ß√µes, pr√°ticas ‚Üí pontos)
   - Migration: `plan_completions` table
   - Hook: `usePlanCompletions`
   - Componente: `CompletionCheckbox` com anima√ß√£o
   - Integra√ß√£o: 4 displays de planos

2. Indicadores visuais de progresso (% completado, progress bars)
   - Componente: `ProgressCard` com trend indicators
   - Dashboard: `OverallProgressDashboard` agregando 4 pilares
   - Anima√ß√µes: framer-motion para preenchimento

3. Loop de feedback ‚Üí IA (feedback do usu√°rio notifica IA e ajusta planos)
   - Migration: `plan_feedback` table
   - Edge Function: `process-plan-feedback`
   - Context: `fetchUserContext` incluir `pendingFeedback`

4. IA proativa com planos espec√≠ficos (referenciar exerc√≠cios/refei√ß√µes do dia)
   - Context: `buildContextPrompt` incluir itens do dia
   - Prompts: Partner stage usar plano real

**M√©tricas de sucesso:**
- DAU/MAU: 0.25 ‚Üí 0.40 (+60%)
- Sess√£o m√©dia: 5min ‚Üí 12min (+140%)
- Churn 30d: 40% ‚Üí 25% (-37.5%)
- NPS: 42 ‚Üí 57 (+15 pontos)

## üßæ Atualiza√ß√µes registradas (log)

- 22/10/2025 ‚Äî Roadmap UX/UI e Gamifica√ß√£o criado (Respons√°vel: JE ‚Ä¢ Execu√ß√£o: GitHub Copilot) ‚Äî Status: Em Planejamento
  - Diagn√≥stico: Visual est√°tico, gamifica√ß√£o superficial, falta de progress√£o visual, baixo engajamento emocional.
  - An√°lise de integra√ß√£o: IA carrega planos e gamifica√ß√£o; gaps identificados (sem tracking de conclus√£o, sem feedback‚ÜíIA).
  - Roadmap: 3 n√≠veis (Quick Wins 1-2sem, Game Changers 2-4sem, Inova√ß√µes 4-8sem).
  - Prioridade P0: Checkboxes de conclus√£o, progress tracking, loop feedback‚ÜíIA, IA proativa.
  - Artefatos: `PLANO_ACAO_UX_GAMIFICACAO.md` (plano detalhado com sprints, c√≥digo, migrations).
  - M√©tricas: DAU/MAU +60%, sess√£o +140%, churn -37.5%, NPS +15pts.
  - Pr√≥ximo passo: Iniciar Sprint 1 (23/10) com checkboxes e progress tracking.

- 22/10/2025 ‚Äî Corre√ß√£o do bug Specialist conclu√≠da (Respons√°vel: JE ‚Ä¢ Execu√ß√£o: GitHub Copilot) ‚Äî Status: Conclu√≠do
  - Bug: Vari√°vel `questionCount` n√£o definida; condi√ß√£o `shouldAdvance` quebrada.
  - Corre√ß√£o: Contador local via `chatHistory`; detec√ß√£o de interesse com regex; condi√ß√£o unificada.
  - Deploy: Fun√ß√£o `ia-coach-chat` (78.56 kB) publicada √†s 09:58 UTC.
  - Valida√ß√£o: Teste HTTP 200; c√≥digo n√£o quebra; l√≥gica operacional confirmada.
  - Arquivo: `supabase/functions/ia-coach-chat/index.ts`, fun√ß√£o `processSpecialistStage`.

- 21/10/2025 ‚Äî Atualiza√ß√£o do Documento Mestre para estado real (Respons√°vel: JE ‚Ä¢ Autor: GitHub Copilot) ‚Äî Status: Conclu√≠do
  - WhatsApp: normaliza√ß√£o/constraints confirmadas; webhook com anti-loop e segredo interno.
  - IA Coach: SPIN no SDR confirmado; Seller com link direto confirmado; bug no Specialist registrado.
  - Planos: fun√ß√£o `generate-plan` e UI "Gerar planos faltantes/Regerar todos" confirmadas.
  - Configura√ß√£o: `verify_jwt=false` com `X-Internal-Secret` entre fun√ß√µes.

## üîó Matriz de rastreabilidade (Problema ‚Üí Causa ‚Üí A√ß√£o)

- Repeti√ß√£o de perguntas/loops no Specialist ‚Üí Falta de estado por √°rea e bug l√≥gico ‚Üí Persistir √°reas em `stage_metadata` e corrigir `shouldAdvance`.
- Planos n√£o vis√≠veis/gera√ß√£o ausente ‚Üí Aus√™ncia de fluxo integrado ‚Üí Edge Function `generate-plan` + bot√µes na UI + recarga de planos ap√≥s gera√ß√£o.
- 401 entre fun√ß√µes (hist√≥rico) ‚Üí JWT verifica√ß√£o e tokens ‚Üí `verify_jwt=false` e valida√ß√£o por `X-Internal-Secret` no servidor.
- Telefones inconsistentes ‚Üí Dados legados com sufixo e caracteres n√£o num√©ricos ‚Üí Migra√ß√µes de normaliza√ß√£o, √≠ndice e constraints.

---

Observa√ß√£o: Este documento reflete apenas fatos verificados no reposit√≥rio e configura√ß√µes neste dia. Itens ‚ÄúN√£o revalidados‚Äù s√£o explicitamente marcados e devem entrar na fila de auditoria.
